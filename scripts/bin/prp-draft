#!/usr/bin/env bash
# Wrapper for prp-draft.py workflow
# Usage: prp-draft "Feature description" [--project /path/to/project]

set -e

# Resolve symlinks to get the actual script location
SCRIPT_PATH="${BASH_SOURCE[0]}"
while [[ -L "$SCRIPT_PATH" ]]; do
    SCRIPT_DIR="$(cd "$(dirname "$SCRIPT_PATH")" && pwd)"
    SCRIPT_PATH="$(readlink "$SCRIPT_PATH")"
    [[ "$SCRIPT_PATH" != /* ]] && SCRIPT_PATH="$SCRIPT_DIR/$SCRIPT_PATH"
done
SCRIPT_DIR="$(cd "$(dirname "$SCRIPT_PATH")" && pwd)"
WORKFLOW_ROOT="$(cd "$SCRIPT_DIR/../.." && pwd)"
VENV_PYTHON="$WORKFLOW_ROOT/.venv/bin/python"
SCRIPT="$WORKFLOW_ROOT/workflows/prp-draft.py"

if [[ ! -f "$VENV_PYTHON" ]]; then
    echo "Error: Virtual environment not found at $WORKFLOW_ROOT/.venv"
    echo "Run: cd $WORKFLOW_ROOT && python3 -m venv .venv && .venv/bin/pip install -r requirements.txt"
    exit 1
fi

exec "$VENV_PYTHON" "$SCRIPT" "$@"
