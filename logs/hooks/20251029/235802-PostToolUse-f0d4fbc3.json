{"session_id":"f0d4fbc3-a5b1-443e-8264-7550e32cfe6a","transcript_path":"/home/thomas/.claude/projects/-home-thomas-Repositories-LangChangeWorkflows/f0d4fbc3-a5b1-443e-8264-7550e32cfe6a.jsonl","cwd":"/home/thomas/Repositories/LangChangeWorkflows","permission_mode":"acceptEdits","hook_event_name":"PostToolUse","tool_name":"Write","tool_input":{"file_path":"/home/thomas/Repositories/LangChangeWorkflows/langgraph/schemas/prp_state.py","content":"\"\"\"\nPRP Workflow State Schema\n\nThis module defines the TypedDict state schema for LangGraph PRP workflows.\nThe state tracks all aspects of PRP execution including gates, retries, costs, and CI/CD.\n\"\"\"\n\nfrom typing import TypedDict, List, Dict, Optional\nfrom datetime import datetime\n\n\nclass PRPState(TypedDict, total=False):\n    \"\"\"\n    Complete state for PRP workflow execution.\n\n    This state is ephemeral (session-only) and tracks:\n    - PRP file location and current phase\n    - Gate validation results and retry counts\n    - Failure handling (circuit breaker, specialist consultations)\n    - Git/PR/CI-CD integration\n    - Cost tracking for optimization metrics\n    \"\"\"\n\n    # Core PRP Information\n    prp_file: str                              # Path to PRP file being executed\n    phase: str                                 # Current phase: \"draft\", \"generate\", \"execute\"\n    workflow_id: str                           # Unique identifier for this workflow run\n    started_at: datetime                       # Workflow start timestamp\n\n    # Gate Validation Status\n    gates_passed: List[str]                    # List of gate IDs that passed (e.g., [\"gate_1_tdd\", \"gate_2_coverage\"])\n    gates_failed: Dict[str, int]               # gate_id: retry_count mapping (e.g., {\"gate_3_mock\": 2})\n    current_gate: Optional[str]                # Gate currently being validated\n\n    # Failure Handling\n    consecutive_failures: int                  # Counter for circuit breaker (stops at 15)\n    specialist_consultations: List[str]        # List of specialist agents consulted\n    failure_history: List[Dict[str, str]]      # Detailed failure log with timestamps\n    circuit_breaker_active: bool               # Whether circuit breaker has been triggered\n\n    # TDD Cycle Tracking\n    tdd_cycle: str                             # Current TDD phase: \"red\", \"green\", \"refactor\"\n    tdd_history: List[Dict[str, str]]          # History of TDD transitions\n\n    # Git Integration\n    branch_name: str                           # Feature branch name\n    base_branch: str                           # Base branch (usually main/master)\n    commit_sha: Optional[str]                  # Latest commit SHA\n\n    # Pull Request Integration\n    pr_number: Optional[int]                   # GitHub/GitLab PR number\n    pr_url: Optional[str]                      # PR URL for easy access\n    pr_status: Optional[str]                   # \"draft\", \"open\", \"approved\", \"merged\"\n\n    # CI/CD Status\n    ci_cd_checks: Dict[str, str]              # check_name: status mapping (e.g., {\"tests\": \"passed\", \"security\": \"running\"})\n    ci_cd_url: Optional[str]                   # CI/CD run URL\n\n    # Cost Tracking (for optimization metrics)\n    cost_tracking: Dict[str, float]           # Cost breakdown by phase/agent\n    token_usage: Dict[str, int]               # Token usage by phase/agent\n    api_calls: int                             # Total API calls made\n    cache_hits: int                            # Number of cache hits (for optimization)\n\n    # Agent Coordination\n    active_agents: List[str]                   # Currently active agent IDs\n    agent_results: Dict[str, Dict]             # agent_id: result mapping\n\n    # Configuration\n    config_overrides: Dict[str, any]           # Project-specific configuration overrides\n    max_retries: int                           # Maximum retries per gate (default: 3)\n    circuit_breaker_threshold: int             # Circuit breaker threshold (default: 15)\n\n    # Metadata\n    project_name: str                          # Project name/identifier\n    project_path: str                          # Project directory path\n    created_by: str                            # User who initiated workflow\n    tags: List[str]                            # Optional tags for categorization\n\n\nclass ValidationResult(TypedDict):\n    \"\"\"\n    Result of a gate validation.\n\n    Returned by each gate node to indicate success/failure\n    and provide actionable feedback.\n    \"\"\"\n    gate_id: str                               # Gate identifier (e.g., \"gate_2_coverage\")\n    passed: bool                               # Whether validation passed\n    message: str                               # Human-readable result message\n    details: Dict[str, any]                    # Detailed validation results\n    retry_count: int                           # Current retry attempt\n    timestamp: datetime                        # When validation completed\n    cost: float                                # Cost of this validation (for tracking)\n    tokens_used: int                           # Tokens consumed\n\n    # Remediation guidance (when failed)\n    suggested_actions: Optional[List[str]]     # Actionable steps to fix failure\n    specialist_required: bool                  # Whether specialist consultation needed\n    specialist_agent: Optional[str]            # Which specialist to consult\n\n\nclass AgentCoordinationState(TypedDict):\n    \"\"\"\n    State for coordinating multiple specialized agents.\n\n    Used in multi-agent workflows like /generate-prp where\n    security-reviewer, devops-engineer, and business-analyst\n    work together.\n    \"\"\"\n    coordinator_id: str                        # Coordination session ID\n    agents_required: List[str]                 # List of agent IDs needed\n    agents_completed: List[str]                # Agents that finished their work\n    agent_outputs: Dict[str, Dict]             # agent_id: output mapping\n    consensus_required: bool                   # Whether agents must agree\n    consensus_achieved: bool                   # Whether consensus was reached\n    conflicts: List[Dict[str, str]]            # Any conflicts between agent outputs\n    resolution_strategy: str                   # How to resolve conflicts: \"majority\", \"senior\", \"human\"\n\n\nclass CostMetrics(TypedDict):\n    \"\"\"\n    Detailed cost tracking for optimization analysis.\n\n    Used to measure and validate the 30-50% cost reduction\n    achieved through LangGraph context sharing and caching.\n    \"\"\"\n    phase: str                                 # \"draft\", \"generate\", \"execute\"\n    gate_id: Optional[str]                     # Gate ID if applicable\n    agent_id: str                              # Agent that incurred cost\n    tokens_used: int                           # Tokens consumed\n    cost_usd: float                            # Cost in USD\n    cache_hit: bool                            # Whether cache was used\n    context_shared: bool                       # Whether context was shared\n    timestamp: datetime                        # When cost was incurred\n    optimization_category: str                 # \"context_sharing\", \"caching\", \"none\"\n\n\nclass CircuitBreakerState(TypedDict):\n    \"\"\"\n    Circuit breaker state to prevent infinite retry loops.\n\n    Tracks consecutive failures and activates circuit breaker\n    at threshold (default: 15 consecutive failures).\n    \"\"\"\n    consecutive_failures: int                  # Current consecutive failure count\n    threshold: int                             # Threshold for activation (default: 15)\n    active: bool                               # Whether circuit breaker is active\n    activation_timestamp: Optional[datetime]   # When circuit breaker activated\n    failure_pattern: List[str]                 # Pattern of failures for analysis\n    recovery_strategy: Optional[str]           # Suggested recovery approach\n    manual_intervention_required: bool         # Whether human intervention needed\n"},"tool_response":{"type":"create","filePath":"/home/thomas/Repositories/LangChangeWorkflows/langgraph/schemas/prp_state.py","content":"\"\"\"\nPRP Workflow State Schema\n\nThis module defines the TypedDict state schema for LangGraph PRP workflows.\nThe state tracks all aspects of PRP execution including gates, retries, costs, and CI/CD.\n\"\"\"\n\nfrom typing import TypedDict, List, Dict, Optional\nfrom datetime import datetime\n\n\nclass PRPState(TypedDict, total=False):\n    \"\"\"\n    Complete state for PRP workflow execution.\n\n    This state is ephemeral (session-only) and tracks:\n    - PRP file location and current phase\n    - Gate validation results and retry counts\n    - Failure handling (circuit breaker, specialist consultations)\n    - Git/PR/CI-CD integration\n    - Cost tracking for optimization metrics\n    \"\"\"\n\n    # Core PRP Information\n    prp_file: str                              # Path to PRP file being executed\n    phase: str                                 # Current phase: \"draft\", \"generate\", \"execute\"\n    workflow_id: str                           # Unique identifier for this workflow run\n    started_at: datetime                       # Workflow start timestamp\n\n    # Gate Validation Status\n    gates_passed: List[str]                    # List of gate IDs that passed (e.g., [\"gate_1_tdd\", \"gate_2_coverage\"])\n    gates_failed: Dict[str, int]               # gate_id: retry_count mapping (e.g., {\"gate_3_mock\": 2})\n    current_gate: Optional[str]                # Gate currently being validated\n\n    # Failure Handling\n    consecutive_failures: int                  # Counter for circuit breaker (stops at 15)\n    specialist_consultations: List[str]        # List of specialist agents consulted\n    failure_history: List[Dict[str, str]]      # Detailed failure log with timestamps\n    circuit_breaker_active: bool               # Whether circuit breaker has been triggered\n\n    # TDD Cycle Tracking\n    tdd_cycle: str                             # Current TDD phase: \"red\", \"green\", \"refactor\"\n    tdd_history: List[Dict[str, str]]          # History of TDD transitions\n\n    # Git Integration\n    branch_name: str                           # Feature branch name\n    base_branch: str                           # Base branch (usually main/master)\n    commit_sha: Optional[str]                  # Latest commit SHA\n\n    # Pull Request Integration\n    pr_number: Optional[int]                   # GitHub/GitLab PR number\n    pr_url: Optional[str]                      # PR URL for easy access\n    pr_status: Optional[str]                   # \"draft\", \"open\", \"approved\", \"merged\"\n\n    # CI/CD Status\n    ci_cd_checks: Dict[str, str]              # check_name: status mapping (e.g., {\"tests\": \"passed\", \"security\": \"running\"})\n    ci_cd_url: Optional[str]                   # CI/CD run URL\n\n    # Cost Tracking (for optimization metrics)\n    cost_tracking: Dict[str, float]           # Cost breakdown by phase/agent\n    token_usage: Dict[str, int]               # Token usage by phase/agent\n    api_calls: int                             # Total API calls made\n    cache_hits: int                            # Number of cache hits (for optimization)\n\n    # Agent Coordination\n    active_agents: List[str]                   # Currently active agent IDs\n    agent_results: Dict[str, Dict]             # agent_id: result mapping\n\n    # Configuration\n    config_overrides: Dict[str, any]           # Project-specific configuration overrides\n    max_retries: int                           # Maximum retries per gate (default: 3)\n    circuit_breaker_threshold: int             # Circuit breaker threshold (default: 15)\n\n    # Metadata\n    project_name: str                          # Project name/identifier\n    project_path: str                          # Project directory path\n    created_by: str                            # User who initiated workflow\n    tags: List[str]                            # Optional tags for categorization\n\n\nclass ValidationResult(TypedDict):\n    \"\"\"\n    Result of a gate validation.\n\n    Returned by each gate node to indicate success/failure\n    and provide actionable feedback.\n    \"\"\"\n    gate_id: str                               # Gate identifier (e.g., \"gate_2_coverage\")\n    passed: bool                               # Whether validation passed\n    message: str                               # Human-readable result message\n    details: Dict[str, any]                    # Detailed validation results\n    retry_count: int                           # Current retry attempt\n    timestamp: datetime                        # When validation completed\n    cost: float                                # Cost of this validation (for tracking)\n    tokens_used: int                           # Tokens consumed\n\n    # Remediation guidance (when failed)\n    suggested_actions: Optional[List[str]]     # Actionable steps to fix failure\n    specialist_required: bool                  # Whether specialist consultation needed\n    specialist_agent: Optional[str]            # Which specialist to consult\n\n\nclass AgentCoordinationState(TypedDict):\n    \"\"\"\n    State for coordinating multiple specialized agents.\n\n    Used in multi-agent workflows like /generate-prp where\n    security-reviewer, devops-engineer, and business-analyst\n    work together.\n    \"\"\"\n    coordinator_id: str                        # Coordination session ID\n    agents_required: List[str]                 # List of agent IDs needed\n    agents_completed: List[str]                # Agents that finished their work\n    agent_outputs: Dict[str, Dict]             # agent_id: output mapping\n    consensus_required: bool                   # Whether agents must agree\n    consensus_achieved: bool                   # Whether consensus was reached\n    conflicts: List[Dict[str, str]]            # Any conflicts between agent outputs\n    resolution_strategy: str                   # How to resolve conflicts: \"majority\", \"senior\", \"human\"\n\n\nclass CostMetrics(TypedDict):\n    \"\"\"\n    Detailed cost tracking for optimization analysis.\n\n    Used to measure and validate the 30-50% cost reduction\n    achieved through LangGraph context sharing and caching.\n    \"\"\"\n    phase: str                                 # \"draft\", \"generate\", \"execute\"\n    gate_id: Optional[str]                     # Gate ID if applicable\n    agent_id: str                              # Agent that incurred cost\n    tokens_used: int                           # Tokens consumed\n    cost_usd: float                            # Cost in USD\n    cache_hit: bool                            # Whether cache was used\n    context_shared: bool                       # Whether context was shared\n    timestamp: datetime                        # When cost was incurred\n    optimization_category: str                 # \"context_sharing\", \"caching\", \"none\"\n\n\nclass CircuitBreakerState(TypedDict):\n    \"\"\"\n    Circuit breaker state to prevent infinite retry loops.\n\n    Tracks consecutive failures and activates circuit breaker\n    at threshold (default: 15 consecutive failures).\n    \"\"\"\n    consecutive_failures: int                  # Current consecutive failure count\n    threshold: int                             # Threshold for activation (default: 15)\n    active: bool                               # Whether circuit breaker is active\n    activation_timestamp: Optional[datetime]   # When circuit breaker activated\n    failure_pattern: List[str]                 # Pattern of failures for analysis\n    recovery_strategy: Optional[str]           # Suggested recovery approach\n    manual_intervention_required: bool         # Whether human intervention needed\n","structuredPatch":[]}}
